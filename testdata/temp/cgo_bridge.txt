// File: cgo_bridge.cpp
/*
This file handles complex C++ operations that can't be directly handled in cgo
*/

#include "gdal_priv.h"
#include "gdalwarper.h"
#include <string>
#include <memory>

extern "C" {
    void* CreateWarpedVRT(void* srcDS, const char* dstWKT, GDALResampleAlg eResample) {
        GDALDataset* poSrcDS = static_cast<GDALDataset*>(srcDS);
        
        auto transformer = std::unique_ptr<void, decltype(&GDALDestroyGenImgProjTransformer)>(
            GDALCreateGenImgProjTransformer(poSrcDS, nullptr, nullptr, dstWKT, TRUE, 0, 1),
            GDALDestroyGenImgProjTransformer
        );
        
        if (!transformer) {
            return nullptr;
        }
        
        void* vrtDS = GDALAutoCreateWarpedVRT(poSrcDS, 
                                             nullptr, 
                                             dstWKT,
                                             eResample, 
                                             0.0, 
                                             nullptr);
        return vrtDS;
    }
}